import json

def open_cache(CACHE_FILENAME):
    '''opens the cache file if it exists and loads the JSON into
    the cache dictionary.
    
    if the cache file doesn't exist, creates a new cache dictionary
    
    Parameters
    ----------
    CACHE_FILENAME: string

    Returns
    -------
    The opened cache
    '''
    try:
        cache_file = open(CACHE_FILENAME, 'r')
        cache_contents = cache_file.read()
        cache_dict = json.loads(cache_contents)
        cache_file.close()
    except:
        cache_dict = {}
    return cache_dict
    

def save_cache(cache_dict, CACHE_FILENAME):
    '''saves the current state of the cache to disk
    Parameters
    ----------
    cache_dict: dict
        the dictionary to save

    CACHE_FILENAME: string
        the file to save into

    Returns
    -------
    None
    '''
    dumped_json_cache = json.dumps(cache_dict)
    fw = open(CACHE_FILENAME, "w")
    fw.write(dumped_json_cache)
    fw.close()

def construct_unique_key(baseurl, params):
    ''' constructs a key that is guaranteed to uniquely and 
    repeatably identify an API request by its baseurl and params
    Parameters
    ----------
    baseurl: string
        The URL for the API endpoint
    params: dictionary
        A dictionary of param: param_value pairs
    Returns
    -------
    string
        the unique key as a string
    '''
    param_strings = []
    connector = '_'
    for k in params.keys():
        param_strings.append(f'{k}_{params[k]}')
    param_strings.sort()
    unique_key = baseurl + connector + connector.join(param_strings)
    return unique_key